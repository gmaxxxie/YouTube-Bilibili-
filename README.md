# YouTube 一键跳转 Bilibili 同名视频

## 📖 脚本介绍

这是一个强大的油猴脚本，可以在YouTube视频页面自动检测当前视频在Bilibili是否有同名视频，并提供便捷的跳转功能。

### ✨ 主要功能

- 🔍 **智能搜索**：自动获取YouTube视频标题，在Bilibili搜索同名视频
- 🎯 **精准匹配**：使用优化的相似度算法，按匹配度排序显示结果
- 🚀 **一键跳转**：点击搜索结果直接跳转到Bilibili视频页面
- 💾 **智能缓存**：缓存搜索结果，避免重复API调用
- 🎮 **用户控制**：点击触发搜索，避免频繁API调用
- 🔄 **状态管理**：从Bilibili返回后，点击按钮可重新显示结果面板

### 🛡️ 技术特性

- **解决412错误**：使用Cookie获取机制，确保API正常访问
- **智能过滤**：自动过滤低匹配度结果，只显示高质量匹配
- **多重备用**：主API失败时自动尝试备用搜索方法
- **增强解析**：支持多种API返回格式，避免显示"undefined"
- **状态持久化**：面板关闭后仍可重新显示，无需重复搜索

## 📦 安装方法

### 方法一：Greasy Fork 安装（推荐）
1. 访问 [Greasy Fork 脚本页面](https://greasyfork.org/scripts/your-script-id)
2. 点击"安装"按钮
3. 确认安装到油猴插件

### 方法二：手动安装
1. 确保已安装油猴插件（Tampermonkey、Violentmonkey等）
2. 下载 `youtube-to-bilibili-v2.user.js` 文件
3. 在油猴插件中创建新脚本
4. 将脚本内容复制粘贴到编辑器中
5. 保存并启用脚本

## 🎯 使用方法

### 基本使用
1. **访问YouTube视频页面**
2. **点击右上角的"🔍 Bilibili"按钮**
3. **等待搜索结果**（通常1-3秒）
4. **选择匹配的视频**，点击跳转到Bilibili

### 高级功能

#### 菜单命令
脚本提供多个菜单命令，右键点击油猴图标即可访问：
- **手动搜索当前视频**：手动触发搜索
- **直接跳转Bilibili搜索**：直接跳转到Bilibili搜索页面
- **测试Bilibili API连接**：测试API连接状态
- **设置匹配阈值**：调整匹配度阈值（0.0-1.0）
- **清除搜索缓存**：清除已缓存的搜索结果
- **查看当前设置**：查看当前配置信息

#### 匹配度说明
- 🟢 **绿色（≥70%）**：高度匹配，推荐观看
- 🟡 **黄色（50-70%）**：中度匹配，值得考虑
- 🟠 **橙色（30-50%）**：低度匹配，仅供参考
- ❌ **低于30%**：自动过滤，不显示

## ⚙️ 配置说明

### 默认配置
```javascript
const CONFIG = {
    MAX_SEARCH_RESULTS: 5,        // 最大搜索结果数
    DEFAULT_THRESHOLD: 0.3,       // 默认匹配阈值（30%）
    CACHE_DURATION: 5 * 60 * 1000, // 缓存时间（5分钟）
    SEARCH_DELAY: 2000,           // 搜索延迟（2秒）
};
```

### 自定义配置
1. 打开油猴插件管理页面
2. 找到本脚本并点击编辑
3. 修改 `CONFIG` 对象中的参数
4. 保存并刷新页面

## 🔧 故障排除

### 常见问题

#### Q: 搜索按钮不显示？
**A:** 确保：
- 在YouTube视频页面（URL包含 `/watch?v=`）
- 页面完全加载完成
- 脚本已正确安装并启用

#### Q: 搜索结果显示"undefined"？
**A:** 这是v2.2版本已修复的问题，请更新到最新版本。

#### Q: API连接失败（412错误）？
**A:** 脚本已内置解决方案：
- 自动获取B站cookies
- 使用新版API接口
- 多重备用搜索机制

#### Q: 从Bilibili返回后按钮无响应？
**A:** 这是v2.3版本已修复的问题，现在可以正常重新显示面板。

#### Q: 搜索结果匹配度太低？
**A:** 可以调整匹配阈值：
1. 使用菜单中的"设置匹配阈值"
2. 或直接修改脚本中的 `DEFAULT_THRESHOLD` 值

### 调试方法
1. 打开浏览器开发者工具（F12）
2. 查看控制台日志，脚本会输出详细的操作信息
3. 使用"测试Bilibili API连接"菜单命令检查API状态

## 🚀 更新日志

### v2.3.0 (最新版本)
- ✅ 修复面板状态管理问题
- ✅ 解决从Bilibili返回后按钮无响应的问题
- ✅ 增强全局状态管理
- ✅ 添加详细的操作日志

### v2.2.0
- ✅ 智能过滤低匹配度结果
- ✅ 避免显示"undefined"信息
- ✅ 增强数据解析，支持多种API格式
- ✅ 改进用户界面和提示信息

### v2.1.0
- ✅ 解决412错误问题
- ✅ 新增Cookie获取机制
- ✅ 使用新版综合搜索API
- ✅ 多重备用搜索机制

### v2.0.0
- ✅ 基于官方API文档优化
- ✅ 增强的视频切换检测
- ✅ 用户点击触发搜索模式
- ✅ 改进的UI设计和用户体验

## 🤝 贡献与反馈

### 报告问题
如果您遇到问题或有改进建议，请：
1. 检查是否是最新版本
2. 查看控制台日志获取错误信息
3. 在GitHub Issues中详细描述问题

### 功能建议
欢迎提出新功能建议，包括：
- UI/UX改进
- 新功能需求
- 性能优化建议

## 📄 许可证

本项目采用 MIT 许可证，详见 [LICENSE](LICENSE) 文件。

## 🙏 致谢

- 感谢 [SocialSisterYi/bilibili-API-collect](https://github.com/SocialSisterYi/bilibili-API-collect) 提供的API文档
- 感谢所有测试用户提供的反馈和建议
- 感谢开源社区的支持

---

**作者：** Maxxie wei  
**版本：** v2.3.0  
**最后更新：** 2024年12月

> 💡 **提示：** 如果脚本对您有帮助，请给个⭐️支持一下！ 
